<?phpclass UserController extends Controller{	public $layout='main';	/**	 * @return array action filters	 */	public function actionIndex(){		$this->render('index');	}		public function actionClosing(){		$this->render('closing');	}		public function actionDashboard(){		$this->layout = false;		if(Yii::app()->user->id==''){  			Yii::app()->user->setFlash('error', "Please login again!");            $this->redirect(array('/site/login'));		} else {			$checkPermission=Yii::app()->session['permissions'];			if(empty($checkPermission)){				Yii::app()->user->setFlash('danger', '<i class="fa fa-times-circle"></i><strong> Permission Denied</strong>');				$this->redirect(array('/site/logout'));			}									//$totalPackages = Packages::Model()->countPackages();			//$totalFranchaise = '';// franchise::Model()->count();			//$countBranch =  Branch::Model()->countBranch();			//$countGreenMember = Registrations::Model()->countGreenMember(); 			//$countRedMember = Registrations::Model()->countRedMember(); 			$sql='SELECT  staff.id, staff.name, staff.mobile, user.username FROM staff left join  user on user.usercode=staff.id WHERE staff.status=0  and user.user_type="3"';			$command=Yii::app()->db->createCommand($sql);			$queryFire=$command->queryAll();									//$countArray=array('totalPackages'=>$totalPackages, 'countBranch'=>$countBranch,'countGreenMember'=>$countGreenMember, 'countRedMember'=>$countRedMember );			$this->render('dashboard',array('staff'=>$queryFire));		}			}		public function actionMember_Dashboard(){		$this->layout = false;		$id=Yii::app()->user->id;				if(Yii::app()->user->getId()===null){  			Yii::app()->user->setFlash('error', "Please login again!");            $this->redirect(array('/site/login'));		} 				$checkPermission=Yii::app()->session['permissions'];		if(!empty($checkPermission)){			Yii::app()->user->setFlash('danger', '<i class="fa fa-times-circle"></i><strong> Permission Denied</strong>');			$this->redirect(array('/site/login'));		}					$AutosharingTurnover = Steppoolamount::Model()->AutosharingTurnover(Yii::app()->user->getState('usercode'));			$MyLevel = Steppoolamount::Model()->MyLevel(Yii::app()->user->getState('usercode'));			$MyDirectSponser =Steppoolamount::Model()->MyDirectSponser(Yii::app()->user->getState('usercode')); 			$totalWalletAmount =Wallet::Model()->getWAlletAmt(Yii::app()->user->getState('usercode')); 			$WithdrawlAmount =Wallet::Model()->WithdrawlAmount(Yii::app()->user->getState('usercode'));			$totalWalletEntry=Wallet::model()->totalWalletEntry(Yii::app()->user->getState('usercode'));							$countArray=array('totalWalletAmount'=>$totalWalletAmount, 'totalWalletEntry'=>$totalWalletEntry,'AutosharingTurnover'=>$AutosharingTurnover, 			'MyLevel'=>$MyLevel, 'MyDirectSponser'=>$MyDirectSponser, 'WithdrawlAmount'=>$WithdrawlAmount );			$this->render('member_dashboard',array('countArray'=>$countArray));			}		public function actionChange_Password(){		$this->layout = false;		$id=Yii::app()->user->getId();				if(Yii::app()->user->getId()===null){  			Yii::app()->user->setFlash('error', "Please login again!");            $this->redirect(array('/site/login'));		} 				$model=new User;		$id=Yii::app()->user->id;		 $model = User::model()->findByAttributes(array('id'=>$id));		 $rid= $model['usercode'];    		 $model->setScenario('changePwd');					 if(isset($_POST['User'])){				 $model->attributes=$_POST['User'];						$valid=$model->validate();                                    if($valid){							$password=$_POST['User']['conformpassword'];							$curentDate=date('Y-m-d');							$connection=Yii::app()->db;							$sql = "UPDATE  user SET  password = '$password' WHERE id = '$id'";							$command = $connection->createCommand($sql);							if($command->execute()){								//$connection1=Yii::app()->db;								//$sql1 = "UPDATE  registrations SET  password = '$password' WHERE Rid = '$rid'";								//$command1 = $connection1->createCommand($sql1);								//$command1->execute();								Yii::app()->user->setFlash('success', '<i class="fa fa-check-circle"></i><strong> Password Update sucessfully!</strong>');								$this->redirect(array('change_password'));							} else {								Yii::app()->user->setFlash('danger', '<i class="fa fa-times-circle"></i><strong> Update Process fail  . Please try again!</strong>');								$this->redirect(array('index'));							}													}			 }		$this->render('change_password',array('model'=>$model));			}			public function actionStaff_Reset_Password(){		$this->layout = false;		$id=base64_decode($_GET['id']);				if(Yii::app()->user->getId()===null){  			Yii::app()->user->setFlash('error', "Please login again!");            $this->redirect(array('/site/login'));		} 		$userid=User::model()->getIdByUserCode($id);		$model=new User;		$id=Yii::app()->user->id;		 $model = User::model()->findByPk($userid); 		 $rid= $model['usercode'];    		 $model->setScenario('staffchangePwd');			 if(isset($_POST['User'])){				 $model->attributes=$_POST['User'];						$valid=$model->validate();                                    if($valid){							$password=$_POST['User']['conformpassword'];							$curentDate=date('Y-m-d');							$connection=Yii::app()->db;							$sql = "UPDATE  user SET  password = '$password' WHERE id = '$userid'";							$command = $connection->createCommand($sql);							if($command->execute()){								Yii::app()->user->setFlash('success', '<i class="fa fa-check-circle"></i><strong> Password Update sucessfully!</strong>');								//$this->redirect(array('staff/index'));							} else {								Yii::app()->user->setFlash('danger', '<i class="fa fa-times-circle"></i><strong> Update Process fail  . Please try again!</strong>');								$this->redirect(array('index'));							}													}			 }		$this->render('staff_reset_password',array('model'=>$model));			}				public function actionLogout(){		Yii::app()->user->setFlash('dange', "Logout Successful!");		Yii::app()->user->logout();		$this->redirect(array('/site/login'));		//$this->redirect(Yii::app()->homeUrl);	}		public function actionMember_Login($search=''){		$this->layout = false;			if(Yii::app()->user->id==''){  				Yii::app()->user->setFlash('error', "Please login again!");				$this->redirect(array('/site/login'));			} 						$checkPermission=Yii::app()->session['permissions'];			if(!empty($checkPermission)){				if($checkPermission[0]['lists']!=0){					Yii::app()->user->setFlash('danger', '<i class="fa fa-times-circle"></i><strong> Permission Denied</strong>');					$this->redirect(array('/user/dashboard'));				}			} 						$model = new User($scenario='search');			$criteria = new CDbCriteria;				if(isset($_GET['User'])){				$model->attributes=$_GET['User'];				$criteria->addSearchCondition('t.usercode', $_GET['User']['usercode'], 0);				$criteria->addSearchCondition('t.username', $_GET['User']['username']."%", 0);			} 						//$criteria->condition = "user_type='2' ";			$criteria->addSearchCondition('t.user_type',2, 0);		$dataProvider=new CActiveDataProvider('User', array('criteria' => $criteria,		'sort'=>array( 'defaultOrder'=> array('id'=>true),  ), 		'pagination' => array ( 'PageSize' =>30,  ) ,		));		$this->render('member_login',array('dataProvider'=>$dataProvider,'model'=>$model));		}/*	public function actions()	{		// return external action classes, e.g.:		return array(			'action1'=>'path.to.ActionClass',			'action2'=>array(				'class'=>'path.to.AnotherActionClass',				'propertyName'=>'propertyValue',			),		);	}	*/}